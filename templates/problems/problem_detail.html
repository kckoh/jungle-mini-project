{% extends 'base.html' %} {% block title %}ì•Œê³ ë¦¬ì¦˜ ìƒì„¸{% endblock %} {% block
content %}
<div class="max-w-5xl mx-auto px-0">
    <!-- ìƒë‹¨ í—¤ë” -->
    <div class="pt-2 pb-4 mx-1">
        <div class="flex items-start justify-between gap-3">
            <div>
                <h1 class="text-xl md:text-2xl font-bold tracking-tight">
                    {{ item.title or 'ì•Œê³ ë¦¬ì¦˜ ì œëª©' }}
                </h1>
                <p class="text-xs text-gray-500 mt-1">
                    {{ item.created_at or 'ë°©ê¸ˆ ì „' }}
                </p>
            </div>
            <a
                href="/problems"
                class="hidden md:inline-flex items-center gap-2 px-3 py-2 rounded-md border border-gray-200 text-sm hover:bg-gray-50"
            >
                ëª©ë¡
            </a>
        </div>
    </div>

    <!-- ê°„ë‹¨ ì„¤ëª… -->
    <div class="mt-2 mb-6 mx-1">{{ item.description or 'ì•Œê³ ë¦¬ì¦˜ ë‚´ìš©' }}</div>

    <!-- í‚¤ì›Œë“œ ì„¹ì…˜ -->
    <div class="border border-gray-200 rounded-xl bg-white overflow-hidden">
        <div class="px-4 md:px-6 py-4 border-b border-gray-200">
            <div class="flex flex-wrap gap-2">
                {% for k, v in keyword_solution.items() %}
                <button
                    class="inline-flex items-center gap-1 text-xs px-2 py-1 rounded-full border border-gray-200"
                    data-value="{{ v }}"
                    onclick="showKeywordValue(this)"
                >
                    {{ k }}
                </button>
                {% endfor %}
            </div>
            <div
                id="keyword-value-display"
                class="mt-2 text-sm text-gray-600 whitespace-pre-wrap"
            ></div>
        </div>
    </div>

    <!-- ë³¸ë¬¸ 2-ì»¬ëŸ¼ -->
    <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- ì¢Œì¸¡: ì ‘ê·¼ë°©ì‹ (ìˆ˜ì •/ì €ì¥ ê¸°ëŠ¥ ìœ ì§€) -->
        <section
            class="bg-white border border-gray-200 rounded-xl p-4 md:p-6 shadow-sm hover:shadow-md transition-colors relative"
        >
            <button
                type="button"
                id="approach-edit-btn"
                class="absolute top-3 right-3 inline-flex items-center gap-1 text-xs px-2 py-1 rounded-md border border-gray-200 hover:bg-gray-50"
                onclick="toggleApproachEdit()"
            >
                âœï¸ ìˆ˜ì •
            </button>

            <h3 class="font-semibold">ì ‘ê·¼ë°©ì‹</h3>

            <!-- ë³´ê¸° ëª¨ë“œ -->
            <p id="approach-view" class="pr-16 text-sm text-gray-700 mt-2 mb-2">
                {{ item.approach }}
            </p>

            <!-- ìˆ˜ì • ëª¨ë“œ -->
            <div id="approach-edit" class="hidden space-y-2">
                <textarea
                    id="approach-input"
                    class="w-full h-32 rounded-md border border-gray-300 p-2 text-sm"
                >
{{- item.approach | trim -}}</textarea
                >
                <div class="flex gap-2">
                    <button
                        type="button"
                        class="text-xs text-blue-600"
                        onclick="saveApproach()"
                    >
                        ğŸ’¾ ì €ì¥
                    </button>
                    <button
                        type="button"
                        class="text-xs text-gray-500"
                        onclick="cancelApproachEdit()"
                    >
                        ì·¨ì†Œ
                    </button>
                </div>
            </div>
        </section>

        <!-- ìš°ì¸¡: AI ì¡°ì–¸ -->
        <section
            class="bg-white border border-gray-200 rounded-xl p-4 md:p-6 shadow-sm hover:shadow-md transition-colors"
        >
            <h3 class="font-semibold">AI ì¡°ì–¸</h3>
            {% set ai = item.aiSuggestion %} {% if ai is string and ai|trim in
            ["ë¦¬ë·° ì¤‘", "ë¦¬ë·°ì¤‘"] %}
            <div
                class="mt-2 inline-flex items-center gap-1 px-3 py-1.5 rounded-full bg-red-100 text-red-700 text-sm font-semibold shadow-sm"
            >
                <svg
                    class="w-4 h-4 text-red-500"
                    fill="currentColor"
                    viewBox="0 0 20 20"
                >
                    <path
                        fill-rule="evenodd"
                        d="M10 18a8 8 0 100-16 8 8 0 000 16zm-.75-4.75a.75.75 0 001.5 0v-1.5a.75.75 0 00-1.5 0v1.5zM10 7a.75.75 0 01.75.75v2.5a.75.75 0 01-1.5 0v-2.5A.75.75 0 0110 7z"
                        clip-rule="evenodd"
                    />
                </svg>
                ë¦¬ë·° ì¤‘
            </div>
            {% elif ai is sequence and ai is not string %}
            <ul class="mt-2 list-disc pl-5 space-y-1 text-sm text-gray-700">
                {% for suggestion in ai %}
                <li>{{ suggestion }}</li>
                {% endfor %}
            </ul>
            {% else %}
            <p class="mt-2 text-sm text-gray-500">AI ì¡°ì–¸ì´ ì•„ì§ ì—†ìŠµë‹ˆë‹¤.</p>
            {% endif %}
        </section>
    </div>
</div>

<!-- Jinja ë°ì´í„° ì£¼ì… -->
<script id="item-data" type="application/json">
    {{ item | tojson }}
</script>

<script>
    // í‚¤ì›Œë“œ í‘œì‹œ í† ê¸€
    let currentEl = null;
    function showKeywordValue(el) {
        const display = document.getElementById("keyword-value-display");
        const raw = el.getAttribute("data-value");
        let value = raw;

        // JSONìœ¼ë¡œ ì§ë ¬í™”ëœ ë¬¸ìì—´ì¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ í•œë²ˆ íŒŒì‹± ì‹œë„
        try {
            value = JSON.parse(raw);
        } catch (_) {
            // íŒŒì‹± ì‹¤íŒ¨ ì‹œ ê·¸ëŒ€ë¡œ ì‚¬ìš©
        }

        if (currentEl === el) {
            display.textContent = "";
            el.classList.remove("bg-gray-100", "border-gray-300");
            currentEl = null;
            return;
        }

        if (currentEl) {
            currentEl.classList.remove("bg-gray-100", "border-gray-300");
        }
        el.classList.add("bg-gray-100", "border-gray-300");

        display.textContent =
            typeof value === "string" ? value : JSON.stringify(value, null, 2);

        currentEl = el;
    }

    // ì ‘ê·¼ë°©ì‹ í¸ì§‘ í† ê¸€
    function toggleApproachEdit() {
        document.getElementById("approach-view").classList.add("hidden");
        document.getElementById("approach-edit").classList.remove("hidden");
        document.getElementById("approach-edit-btn").classList.add("hidden");
    }
    function cancelApproachEdit() {
        document.getElementById("approach-view").classList.remove("hidden");
        document.getElementById("approach-edit").classList.add("hidden");
        document.getElementById("approach-edit-btn").classList.remove("hidden");
    }

    // ì ‘ê·¼ë°©ì‹ ì €ì¥(PATCH)
    async function saveApproach() {
        const newApproach = document
            .getElementById("approach-input")
            .value.trim();
        const item = JSON.parse(
            document.getElementById("item-data").textContent,
        );

        const res = await fetch(`/api/posts/${item.id}`, {
            method: "PATCH",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ approach: newApproach }),
        });

        if (res.ok) {
            document.getElementById("approach-view").textContent = newApproach;
            cancelApproachEdit();
            alert("ì—…ë°ì´íŠ¸ ì„±ê³µ");
        } else {
            alert("ì—…ë°ì´íŠ¸ ì‹¤íŒ¨");
        }
    }
</script>
{% endblock %}

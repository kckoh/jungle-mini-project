{% extends 'base.html' %}
{% block title %}관심 문제{% endblock %}
{% block content %}
  <section class="max-w-5xl mx-auto px-0">
    <div class="text-sm mb-6 border border-gray-200 rounded-lg p-4 bg-white">
        <form id="searchForm" method="get" action="/problems" class="flex flex-wrap items-center gap-3">
          <select id="field_mode" name="field_mode"  <!-- ← name 추가 -->
                  class="border border-gray-200 rounded-lg px-2 py-2 text-sm outline-black bg-white"
                  aria-label="검색 필드 선택">
            <option value="title"       {{ 'selected' if field_mode=='title'       else '' }}>제목</option>
            <option value="description" {{ 'selected' if field_mode=='description' else '' }}>내용</option>
          </select>
        <div class="flex-1 min-w-[260px] flex items-center gap-2">
            <!-- 검색창 -->
          <input name="q" value="{{ q or '' }}" class="w-full border border-gray-200 rounded-lg px-3 py-2 text-sm outline-black" placeholder="검색어를 입력하세요" />
          <button type="submit" onclick="document.querySelector('[name=page]').value=1" class="h-10 w-10 inline-flex items-center justify-center rounded-md border border-gray-200 hover:bg-gray-50" aria-label="검색">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="h-5 w-5 text-gray-700"><path fill-rule="evenodd" d="M9 3.5a5.5 5.5 0 1 0 3.473 9.8l3.613 3.614a.75.75 0 1 0 1.06-1.06l-3.614-3.614A5.5 5.5 0 0 0 9 3.5Zm-4 5.5a4 4 0 1 1 8 0 4 4 0 0 1-8 0Z" clip-rule="evenodd"/></svg>
          </button>
        </div>
        <input type="hidden" name="page" value="{{ page or 1 }}" />
      </form>
    </div>

    <!-- 관심 문제 리스트 (index 카드 톤) -->
    <div class="space-y-4">
      {% if items and items|length > 0 %}
        {% for p in items %}
          <article class="relative border border-gray-200 rounded-lg bg-white p-4">
            <div class="flex items-start justify-between gap-4">
              <h2 class="font-medium truncate">{{ p.title }}</h2>
              <span class="text-xs text-gray-500 shrink-0">{{ p.created_at or '방금 전' }}</span>
            </div>
            {% if p.tags %}
            <span class="inline-flex items-center gap-1 text-[11px] px-2 py-0.5 rounded-full border border-green-200 bg-green-50 text-green-700">
              AI 문제 분석 완료
            </span>
            {% for tag in p.tags %}
              <span class="text-xs px-2 py-1 rounded-full border border-gray-200">{{ tag }}</span>
            {% endfor %}
            {% else %}
            <span class="inline-flex items-center gap-1 text-[11px] px-2 py-0.5 rounded-full border border-yellow-200 bg-yellow-50 text-yellow-700 mt-2">
              문제 분석 중
            </span>
            {% endif %}
        
            <div class="mt-3">
              <a href="/problems/{{ p._id }}" class="inline-flex items-center text-xs px-2 py-1 rounded border border-gray-200 hover:bg-gray-50">자세히 보기</a>
            </div>
          </article>


        {% endfor %}
      {% else %}
        <div class="border border-dashed rounded-lg p-6 text-center text-gray-500 bg-white">아직 담은 문제가 없어요. <a class="underline" href="/problems/new">새 문제 등록하기 →</a></div>
      {% endif %}
    </div>
    <!-- 페이지네이션 -->
  <div class="flex justify-center items-center gap-4 mt-6">
  {% if page > 1 %}
    <a href="{{ url_for('problems', page=page-1, q=q, field_mode=field_mode) }}"
       class="px-4 py-2 border rounded hover:bg-gray-50">이전</a>
  {% endif %}

  <span class="text-gray-700">페이지 {{ page }}</span>

  {% if nextPage %}
    <a href="{{ url_for('problems', page=page+1, q=q, field_mode=field_mode) }}"
       class="px-4 py-2 border rounded hover:bg-gray-50">다음</a>
  {% endif %}
</div>


  </section>
  {% if pages and pages > 1 %}
  <div class="mt-6 flex items-center justify-center gap-2">
    {% set qs = request.query_string.decode('utf-8') or '' %}
    {% if 'page=' in qs %}
      {% set qs_prev = qs | replace('page=' ~ page, 'page=' ~ (page-1)) %}
      {% set qs_next = qs | replace('page=' ~ page, 'page=' ~ (page+1)) %}
    {% else %}
      {% set sep = '&' if qs else '' %}
      {% set qs_prev = qs ~ sep ~ 'page=' ~ (page-1) %}
      {% set qs_next = qs ~ sep ~ 'page=' ~ (page+1) %}
    {% endif %}
    <a class="px-3 py-2 text-sm rounded border border-gray-200 hover:bg-gray-50 {{ 'pointer-events-none opacity-40' if page <= 1 }}" href="{{ '/problems?' ~ qs_prev if page>1 else '#' }}">이전</a>
    <span class="text-sm text-gray-600">{{ page }} / {{ pages }}</span>
    <a class="px-3 py-2 text-sm rounded border border-gray-200 hover:bg-gray-50 {{ 'pointer-events-none opacity-40' if page >= pages }}" href="{{ '/problems?' ~ qs_next if page<pages else '#' }}">다음</a>
  </div>
  {% endif %}

{% endblock %}
